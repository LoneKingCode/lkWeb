@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout_Body.cshtml";
}
@section Scripts{
    <script>
        var departmentID = "";
        $(function () {
            InitDataTable();

            $(".checkAll").click(function () {
                var check = $(this).prop("checked");
                $(".checkChild").prop("checked", check);
            });

            $("#btnSearch").click(function () {
                lkWeb.Search($("#txtSearchKey").val(), table_department);

            })
        });

        function AddModel() {
            $(":checkbox:checked", "#table_department").each(function (i, n) {
                if ($(n).attr("class") == "checkAll") return true;//相当于continue
                departmentID = $(n).val();
            })

            lkWeb.GoAction("department", "add", departmentID);;
        }
        function EditModel() {
            var id = "";
            $(":checkbox:checked", "#table_department").each(function (i, n) {
                if ($(n).attr("class") == "checkAll") return true;//相当于continue
                 id = $(n).val();
                lkWeb.GoAction("department", "edit", id);
            })
            if (id == "")
                parent.layer.alert("请选择");
        }

        function DelModel() {
            var ids = [];
            $(":checkbox:checked", "#table_department").each(function (i, n) {
                if ($(n).attr("class") == "checkAll") return true;//相当于continue
                ids.push($(n).val());
            })
            lkWeb.DeleteMulti(ids, "department", table_department);
        }

        var table_department;
        function InitDataTable() {
            var dataUrl = '@Url.Action("GetPageData")';
            var columns = [
                {
                    "sClass": "text-center",
                    "mData": "id",
                    "mRender": function (data, type, row) {
                        return '<input type="checkbox" class="checkChild"  value="' + data + '" />';
                    },
                    "bSortable": false
                },
                { "mData": "id", "sClass": "text-center" },
                { "mData": "name", "sClass": "text-center" },
                { "mData": "parentName", "sClass": "text-center" },
                { "mData": "description", "sClass": "text-center" },
                { "mData": "createDateTime", "sClass": "text-center" },
            ];
            table_department = lkWeb.LoadTable("table_department", columns, dataUrl)
    }


    </script>
}
<div class="data-content" style="padding:15px 0 0 15px;">
    <h2>部门管理</h2>
    <hr />
    <div class="form-group">
        <button type="button" class="btn btn-success" onclick="AddModel()">添加</button>
        <button type="button" class="btn btn-info" onclick="EditModel()">编辑</button>
        <button type="button" class="btn btn-danger" onclick="DelModel()">删除</button>
    </div>
    <div class="form-group">
        <div class="input-group">
            <input id="txtSearchKey" type="text" class="form-control" placeholder="搜索关键字">
            <span class="input-group-btn">
                <button id="btnSearch" class="btn btn-primary" type="button"> <i class="fa fa-search"></i> 搜索</button>
            </span>
        </div>
    </div>
    <table class="table table-striped table-hover" id="table_department">
        <thead>
            <tr>
                <th>
                    <input type="checkbox" class="checkAll" />
                </th>
                <th>Id</th>
                <th>部门名称</th>
                <th>上级部门</th>
                <th>部门描述</th>
                <th>创建时间</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

</div>