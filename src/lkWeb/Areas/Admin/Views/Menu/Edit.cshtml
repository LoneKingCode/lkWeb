@using lkWeb.Service.Dto
@model MenuDto
@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout_Content.cshtml";
    ViewBag.Title = "编辑菜单";
}
@section Scripts{
    <script src="~/lib/bootstrap-suggest-plugin/dist/bootstrap-suggest.min.js"></script>

    <script type="text/javascript">
    $(function () {
        lkWeb.FormValidation($("#lkForm"), function () {
                lkWeb.GoAction("admin","menu", "index")
            }, "操作成功")

        $("#menuList").focusin(function () {
                 $("#menuList").bsSuggest('init', {
                    allowNoKeyword: !0,
                    multiWord: !0,
                    showHeader: !0,
                    effectiveFieldsAlias: {
                        id: "Id",
                        name: "名称",
                        typeName: "类型",
                        url: "URL地址"
                    },
                    effectiveFields: ["id", "name", "typeName", "url"],
                    getDataMethod: "url",
                    url: "@Url.Action("GetList", "Menu")?searchKey=", //最后一个参数为关键字请求参数
                    idField: "id",
                    keyField: "name"
                }).on('onDataRequestSuccess', function (e, result) {

                }).on('onSetSelectValue', function (e, keyword, data) {
                     $("#txtParentId").val(keyword.id);
                }).on('onUnsetSelectValue', function () {
                 });
            })
        })
        function SelectModule(value) {
            $("#txtModuleId").val(value);
        }
                function ViewIcon() {
            var url = " http://www.fontawesome.com.cn/faicons/";
            lkWeb.OpenLayer(url, "图标库", "80%", "500px");
        }
    </script>
}
<form class="form-horizontal" action="@Url.Action("Edit");" method="post" id="lkForm">
    @Html.AntiForgeryToken()
    @Html.HiddenFor(item => item.Id, new { @class = "form-control" })
    @Html.HiddenFor(item => item.Type, new { @class = "form-control" })
    <div class="form-group">
        <label class="col-md-3 control-label">所属模块</label>
        <div class="col-md-7">
            <input name="ModuleId" type="hidden" id="txtModuleId" value="@ViewBag.ModuleId" />
            @Html.DropDownList("ModuleId", (SelectList)ViewBag.Modules, new { @class = "form-control", @onchange = "SelectModule(this.value)" })
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">上级菜单</label>
        <div class="col-md-7">
            <div class="input-group">
                <input name="ParentID" type="hidden" id="txtParentId" asp-for="ParentId" />
                <input class="form-control" type="text" autocomplete="off" id="menuList" value="@ViewBag.ParentName" />
                <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">菜单名称</label>
        <div class="col-md-7">
            <input type="text" class="form-control" name="Name" asp-for="Name"
                   data-val="true" data-val-maxlength="菜单名称长度不能超过18个字符" data-val-maxlength-max="8"
                   data-val-minlength="菜单名称长度不能少于2个字符" data-val-minlength-min="2" data-val-required="菜单名称不能为空" />
            <span class="field-validation-valid" data-valmsg-for="Name" data-valmsg-replace="true"></span>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">URL地址</label>
        <div class="col-md-7">
            <input type="text" class="form-control" name="Url" asp-for="Url"
                   data-val="true" data-val-maxlength="菜单地址不能超过200个字符" data-val-maxlength-max="200"
                   data-val-minlength="菜单地址不能少于1个字符" data-val-minlength-min="1" data-val-required="菜单地址不能为空" />
            <span class="field-validation-valid" data-valmsg-for="Url" data-valmsg-replace="true"></span>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">菜单图标</label>
        <div class="col-md-7">
            <input type="text" class="form-control" asp-for="Icon"
                   data-val="true" data-val-maxlength="菜单图标不能超过50个字符" data-val-maxlength-max="50" />
            <span class="field-validation-valid" data-valmsg-for="Icon" data-valmsg-replace="true"></span>
            <button class="btn btn-sm btn-info" style="margin:3px;" type="button" onclick="ViewIcon()">查看图标库</button>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">排序</label>
        <div class="col-md-7">
            <input type="text" class="form-control" name="ListOrder" asp-for="ListOrder"
                   data-val-number="排序必须是一个数字。" data-val-required="排序不能为空" data-val="true" />
            <span class="field-validation-valid" data-valmsg-for="ListOrder" data-valmsg-replace="true"></span>
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-3 col-md-offset-3">
            <button type="submit" class="btn btn-success">确定</button>
            <button type="button" class="btn btn-default" onclick="history.go(-1)">返回</button>
        </div>
    </div>
</form>