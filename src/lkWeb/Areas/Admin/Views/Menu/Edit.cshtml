@using lkWeb.Service.Dto
@model MenuDto
@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout_Content.cshtml";
    ViewBag.Title = "编辑菜单";
}
@section Scripts{
    <script src="~/lib/bootstrap-suggest-plugin/dist/bootstrap-suggest.min.js"></script>

    <script type="text/javascript">
    $(function () {

            $("#menuList").keyup(function () {
                 $("#menuList").bsSuggest('init', {
                    allowNoKeyword: !0,
                    multiWord: !0,
                    showHeader: !0,
                    effectiveFieldsAlias: {
                        id: "Id",
                        name: "名称",
                        typeName: "类型",
                        url: "URL地址"
                    },
                    effectiveFields: ["id", "name", "typeName", "url"],
                    getDataMethod: "url",
                    url: "@Url.Action("GetList", "Menu")?searchKey=",
                    idField: "id",
                    keyField: "name"
                }).on('onDataRequestSuccess', function (e, result) {

                }).on('onSetSelectValue', function (e, keyword, data) {
                     $("#txtParentID").val(keyword.id);
                }).on('onUnsetSelectValue', function () {
                    console.log('onUnsetSelectValue');
                });
            })
        })
        function Save() {
            var option = {
                datatype: "json",
                success: function (data) {
                    if (data.flag == true) {
                        parent.layer.alert("操作成功");
                        lkWeb.GoAction("menu", "index", 0);
                    }
                    else {
                        parent.layer.alert(data.msg);
                    }
                },
                error: function (error) {
                    parent.layer.alert('提交请求失败');
                    console.log(error);
                }
            };
            $("#form-editMenu").ajaxSubmit(option);
        }
    </script>
}
<form class="form-horizontal" action="@Url.Action("Edit", "Menu");" method="post" id="form-editMenu">
    @Html.HiddenFor(item => item.Id, new { @class = "form-control" })
    <div class="form-group">
        <label class="col-md-3 control-label">上级菜单</label>
        <div class="col-md-7">
            <div class="input-group">
                <input name="ParentID" type="hidden" id="txtParentID" asp-for="ParentId" />
                <input class="form-control" type="text" autocomplete="off" id="menuList" value="@ViewBag.ParentName" />
                <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">菜单名称</label>
        <div class="col-md-7">
            <input type="text" class="form-control" name="Name" asp-for="Name" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">URL地址</label>
        <div class="col-md-7">
            <input type="text" class="form-control" name="Url" asp-for="Url" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-3 control-label">排序</label>
        <div class="col-md-7">
            <input type="text" class="form-control" name="Order" asp-for="Order" />
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-3 col-md-offset-3">
            <button type="button" class="btn btn-success" onclick="Save();">确定</button>
            <button type="button" class="btn btn-default" onclick="history.go(-1)">返回</button>
        </div>
    </div>
</form>