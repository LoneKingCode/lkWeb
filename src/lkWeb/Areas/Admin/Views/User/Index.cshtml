@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout_Body.cshtml";
}
@section Scripts{
    <script>
        $(function () {
            InitDataTable();

            $(".checkAll").click(function () {
                var check = $(this).prop("checked");
                $(".checkChild").prop("checked", check);
            });

            //用户主页 确定操作
            $("#btnOperate").click(function () {
                var select = $("#sltOperate");
                var selectVal = select.val();
                if (selectVal == "delete") {
                    var ids = [];
                    $(":checkbox:checked", "#table_user").each(function (i, n) {
                        if ($(n).attr("class") == "checkAll") return true;//相当于continue
                        ids.push($(n).val());
                    })
                    lkWeb.DeleteMulti(ids,"user",table_user);
                }
                else if (selectVal == "disable") {
                    alert("disable");
                }

            })
            //用户主页 增加用户
            $("#btnGoToAddUser").click(function () {
                lkWeb.GoAction("user", "add", 0);
            })
            //角色授权
            $("#btnRoleAuth").click(function () {
                var userId = "";
                $(":checkbox:checked", "#table_user").each(function (i, n) {
                    if ($(n).attr("class") == "checkAll") return true;//相当于continue
                    userId = $(n).val(); //只要一个用户ID 如果多选的话也只要最后一个
                })
                if (userId == "") {
                    parent.layer.alert("请选择用户");
                    return;
                }
                lkWeb.GoAction("user", "authen", userId);
            })

        });
        function DeleteUser(id)
        {
            lkWeb.Delete(id, "user", table_user);
        }
        function GoToEditUser(userID) {
            lkWeb.GoAction("user", "edit", userID);
        }
        var table_user;
        function InitDataTable() {
            var url = '@Url.Action("GetList")';
            $.fn.dataTableExt.sErrMode = 'throw';

        var config = {
            "processing": true,
            "bInfo": true, //是否显示是否启用底边信息栏
            "sAjaxSource": url,
            'autoWidth': true,
            "sPaginationType": "full_numbers",
            "oLanguage": {
                "sProcessing": "请求数据中......",
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "抱歉， 没有找到",
                "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "sSearch": "搜索",
                "oPaginate": {
                    "sFirst": "<button type=\"button\" class=\"btn btn-primar\" >首页</button>",
                    "sPrevious": "<button type=\"button\" class=\"btn btn-primar\" >上一页</button>",
                    "sNext": "<button type=\"button\" class=\"btn btn-primar\" >后一页</button>",
                    "sLast": "<button type=\"button\" class=\"btn btn-primar\" >尾页</button>"
                }
            },
            "sZeroRecords": "没有检索到数据",
            "retrieve": true,
            "paging": true,
            "ordering": true,
            "info": true,
            "aoColumns": [
                {
                    "sClass": "text-center",
                    "mData": "id",
                    "mRender": function (data, type, row) {
                        return '<input type="checkbox" class="checkChild"  value="' + data + '" />';
                    },
                    "bSortable": false
                },
                { "mData": "id", "sClass": "text-center" },
                { "mData": "loginName", "sClass": "text-center" },
                { "mData": "realName", "sClass": "text-center" },
                { "mData": "email", "sClass": "text-center", "bSortable": false },
                { "mData": "statusName", "sClass": "text-center" },
                { "mData": "createDateTime", "sClass": "text-center" },
                {
                    "sClass": "text-center",
                    "mData": "id",
                    "mRender": function (data, type, row) {
                        return "<button type=\"button\" class=\"btn btn-success\" onClick=\"GoToEditUser(" + data+ ")\">编辑</button>";
                    },
                    "bSortable": false
                },
                {
                    "sClass": "text-center",
                    "mData": "id",
                    "mRender": function (data, type, row) {
                        return "<button type=\"button\" class=\"btn btn-delete\" onClick=\"DeleteUser(" + data + ")\">删除</button>";
                    },
                    "bSortable": false
                },
            ],
            'columnDefs': [
                {
                    'targets': 0,
                    'checkboxes': {
                        'selectRow': true
                    }
                }
            ],
            'select': {
                'style': 'multi'
            },
            'order': [[1, 'asc']]
        };
          table_user = $("#table_user").dataTable(config);
    }


    </script>
}
<div class="data-content" style="padding:15px 0 0 15px;">
    <h2>用户管理</h2>
    <hr />
    <div style="margin-bottom:7px;">
        <button type="button" class="btn btn-success" id="btnGoToAddUser">新增用户</button>
        <span style="margin-left:15px;"></span>
        <label class="control-label">操作</label>
        <select id="sltOperate">
            <option value="0"></option>
            <option value="delete">删除</option>
            <option value="disable">禁用</option>
        </select>
        <button type="button" class="btn btn-success" id="btnOperate">确定操作</button>
        <button type="button" class="btn btn-info" id="btnRoleAuth">角色授权</button>
    </div>
    <table class="table table-striped table-hover" id="table_user">
        <thead>
            <tr>
                <th>
                    <input type="checkbox" class="checkAll" />
                </th>
                <th>Id</th>
                <th>用户名</th>
                <th>姓名</th>
                <th>电子邮箱</th>
                <th>状态</th>
                <th>创建日期</th>
                <th>编辑</th>
                <th>删除</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
